# チケット駆動開発規約
# Redmine #4069 で策定

rules:
  must:
    - チケットの追跡なしにファイルを変更してはならない
    - チケット受領時に親チケットの情報を取得し、経緯と意図を把握する
    - 作業開始時にステータスを「着手中」に変更する
    - 不明点がある場合はオーナーへ質問する
    - オーナーから回答を得たら即座にチケットへ中間報告を起票する
      - ファイルの変更があれば必ずコミットすること
    - 実装完了時にステータスを「レビュー待機」に変更し、完了報告をオーナーへ提示する
    - オーナー承認後にチケットへ完了報告を起票し、ステータスをクローズにする
    - チケットへの起票は実や意図を漏れなくかつトークン量節約のため簡潔かつ端的な記述とすること

  must_not:
    - 中間報告せずに次の作業に進んではならない
    - 親チケットを確認せずに作業を開始してはならない
    - オーナーの承認なしにチケットをクローズしてはならない

  should:
    - 選択肢がある場合はpro/conを提示してオーナーの指示を仰ぐ
    - 計画・意図は記載前にオーナーへ提示し、許諾を得てから記載する

intent:
  summary: |
    AIエージェントがチケット駆動で作業を行う際の規約。
    オーナーとの協働において、進捗の可視化と意思決定の記録を確実にする。

  background: |
    問題: 規約を「読んだ」だけで行動に反映されない
    解決: トリガー・アクション形式で明確化し、must/must_notで強制力を持たせる

methods:
  - name: チケット受領時
    when: 新しいチケットの作業を開始する時
    action: |
      1. 親チケットの情報を取得（get_issue_detail_tool）
      2. comment, description を読み経緯と意図を把握
      3. ステータスを「着手中」に変更（update_issue_status_tool）

  - name: オーナー質問時
    when: 不明点や選択肢がある時
    action: |
      1. 選択肢がある場合はpro/conを提示
      2. オーナーの回答を待つ

  - name: オーナー回答受領時
    when: オーナーから質問への回答を得た時
    action: |
      1. 即座にチケットへ中間報告を起票（add_issue_comment_tool）
      2. 回答内容・判断事項・実施済み・実施予定を記載
      3. その後、作業を続行

  - name: 実装完了時
    when: 実装が完了した時
    action: |
      1. ステータスを「レビュー待機」に変更
      2. 完了報告をオーナーへ提示
      3. オーナーの承認を待つ

  - name: オーナー承認時
    when: オーナーから承認を得た時
    action: |
      1. チケットへ完了報告を起票
      2. 問題・実装・意図・(計画・計画の意図)を記載
      3. ステータスをクローズに変更

format:
  subject: plaintext
  description: markdown
  comment: markdown

  comment_template: |
    ## 中間報告

    - コミットハッシュ

    ### 判断事項
    - **質問内容** → 回答内容

    ### 実施済み
    - [x] 完了したタスク
      - 実装の意図

    ### 実施予定
    - [ ] 未完了のタスク
      - 実施の意図

ticket_structure:
  hierarchy:
    - Epic: docs/logics/* と対応する大機能群（原則変更不可）
    - Feature: docs/logics/**/ と対応する小機能群（原則変更不可）
    - UserStory: タスクの抽象的説明や意図（実作業はTask/Bug/Testに分解）
    - Task: 各実装単位
    - Test: テストコード実装単位
    - Bug: 当初の意図と異なる挙動を修正する単位

version_naming:
  format: "{mmdd}リリース"
  example: "0118リリース"
  release_days:
    - 月曜
    - 水曜
    - 金曜
    - 日曜

related_files:
  config: .claude-nagger/config.yaml
  tachikoma_prompt: vibes/docs/rules/ai_tachikoma_agent_promt.md
